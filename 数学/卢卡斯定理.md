# 卢卡斯定理

$$
设p为素数，a,b\in N，并且
\\
a = a_kp^k+a_{k-1}p^{k-1}+...+a_1p+a_0,
\\

b=b_kp^k+b_{k-1}p^{k-1}+...+b_1p+b_0,
\\
0\le a_i,b_i \le p-1都是整数，则C_a^b\equiv C_{a_k}^{b_k}C_{a_{k-1}}^{b_{k-1}}...C_{a_0}^{b_0}\ (mod\ p)
\\
$$

$$
引入多项式同余记号
\\
f(x)=a_nx^n+a_{n-1}x^{n-1}+...+a_0
\\
g(x)=b_nx^n+b_{n-1}x^{n-1}+...+b_0
\\
$$

$$
如果对0\le i\le n,都有a_i\equiv b_i(mod\ m)，那么称f(x)与g(x)对模m同余，记作f(x)\equiv g(x)(mod\ m)
$$

$$
\\
由于p是质数，所以对1\le j \le p-1，有C_p^j=\frac{p}{j}C_{p-1}^{j-1}\equiv 0 (mod\ p)
\\
于是，(1+x)^p=1+C_p^1x+...+C_p^{p-1}x^{p-1}+x^p\equiv 1 + x^p(mod\ p)
\\
$$

$$
(1+x)^a=(1+x)^{a_0}((1+x)^p)^{a_1}...((1+x)^{p^k})^{a^k}
\\
equiv(1+x)^{a_0}((1+x)^p)^{a_1}...((1+x)^{p^k})^{a^k}(mod\ p)
$$

$$
对比上式中x^b的系数，可得C_a^b\equiv C_{a_k}^{b_k}C_{a_{k-1}}^{b_{k-1}}...C_{a_0}^{b_0}\ (mod\ p)
$$

[原题链接](https://www.acwing.com/problem/content/889/) Acwing 887 求组合数III

```c++
#include <iostream>

using namespace std;

typedef long long LL;

const int N = 10010;
int fact[N], infact[N];

int qmi(LL a, LL p, int mod)
{
    int res = 1;
    while (p)
    {
        if (p & 1) res = (LL) res * a % mod;
        a = (LL) a * a % mod;
        p >>= 1;
    }
    return res;
}

int C(LL a, LL b, int p)
{
    if (b > a) return 0;
    int res = 1;
    for (int i = 1, j = a; i <= b; i ++, j --)
    {
        res = (LL) res * j % p;
        res = (LL) res * qmi(i, p - 2, p) % p;
    }
    return res;
}

int lucas(LL a, LL b, int p)
{
    if (a < p && b < p) return C(a, b, p);
    return (LL) C(a % p, b % p, p) * lucas(a / p, b / p, p) % p;
}

int main()
{
    int n;
    cin >> n;
    for (int i = 0; i < n; i ++)
    {
        LL a, b;
        int p;
        cin >> a >> b >> p;
        cout << lucas(a, b, p) << endl;
    }
    return 0;
}
```



